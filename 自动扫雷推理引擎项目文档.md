# 自动扫雷推理引擎项目文档

## 一、项目总览

本项目目前实现了基础模式（`mine_sweeper`），用于自动化推理扫雷游戏中的格子状态。

未来将支持多个模式（如 Quad 模式、多雷规则模式、块状约束模式等），每种推理模式将单独文档说明，保持清晰的模块化结构。

---

## 二、状态常量解释

```python
HIDDEN = -2       # 未打开格子
MINE = -1         # 标记为雷
NOT_MINE = -3     # 标记为非雷

LEGAL = 2         # 合法
POSSIBLE = 1      # 待确认
ILLEGAL = 0       # 不合法
```

---

## 三、类结构总览（基础模式）

### 3.1 `mine_sweeper` 类

#### 主要属性
- `num_mines`：雷的总数
- `map`：当前场景，包括数字/雷/未知等
- `legal_map`：各格子是否合法
- `legal`：整个场景是否合法

#### 核心方法

- **合法性判断**
  - `is_legal()`：判断当前场景是否满足数字提示规则
- **一阶逻辑推理**
  - `first_order_deduct()`：根据数字和周围状态推理哪些格子是雷或非雷
- **递归推理**
  - `recursion_deduct()`：递归分析当前的局面是否合法（存不存在一种雷的分布满足当前所有已知约束）
- **场景更新**
  - `update_deduct()`：自动循环扫描场景，进行更新和标记，并且将更新的操作在控制台打印出来

> 更多推理逻辑详情请见附录文档：`推理函数逻辑详解.md`

---

## 四、推理策略概览

- 一阶推理：若数字周围雷数已满，则其余为非雷；若数字等于（雷 + 未知）数量，则未知格全为雷。
- 递归推理：尝试未知格为雷和非雷两种情况，递归判断是否存在合法解。

---

## 五、简单演示

```python
if __name__=='__main__':
    num_mines = 5
    map = np.array([[-2,  1,  2,  1,-2],
                    [-2, -2, -2, -2,-2],
                    [-3, -2, -2, -2,-2],
                    [ 1, -3,  1, -2,-2]])
    # -1代表这个格子是雷，-2代表这个格子未打开，-3代表这个格子不是雷

    print('原始局面:')
    print(map)
    ms = mine_sweeper(num_mines, map)
    ms.first_order_deduct()
    print('一阶推理后的局面：')
    print(ms.map)

    result, list_open, list_mark = ms.update_deduct()
    print('全自动推理后的局面：')
    print(ms.map)
```
以上代码的输出为：
```
原始局面:
[[-2  1  2  1 -2]
 [-2 -2 -2 -2 -2]
 [-3 -2 -2 -2 -2]
 [ 1 -3  1 -2 -2]]
一阶推理后的局面：
[[-2  1  2  1 -2]
 [-2 -2 -2 -2 -2]
 [-3 -1 -3 -3 -2]
 [ 1 -3  1 -3 -2]]
box (0,0): open
box (0,4): open
box (1,0): open
box (1,1): mark as mine
box (1,2): open
box (1,3): mark as mine
box (1,4): open
box (2,4): mark as mine
box (3,4): mark as mine
全自动推理后的局面：
[[-3  1  2  1 -3]
 [-3 -1 -3 -1 -3]
 [-3 -1 -3 -3 -1]
 [ 1 -3  1 -3 -1]]
```
---

> 注：如需了解 Quad 或其他模式，请查阅各自文档，如 `Quad模式推理逻辑文档.md`。

